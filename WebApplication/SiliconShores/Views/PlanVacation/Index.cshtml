@using SiliconShores.Models
@model SiliconShores.Models.VacationPlanViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Plan Your Perfect Day</h2>
<hr />
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        @Html.ValidationSummary("", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(m => m.ArrivalDate, new { @class = "col-md-2 control-label"})
            <div class="col-md-10">
                @Html.TextBoxFor(m => m.ArrivalDate, new { @class = "form-control" })
                @Html.Label("Format: MM/DD/YYYY")
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Nights, new {@class = "col-md-2 control-label"})
            <div class="col-md-10">
                @Html.TextBoxFor(m => m.Nights, new {@class = "form-control"})
            </div>
        </div>

        @{ var count = 0;}
        @foreach (var t in ViewBag.TicketTypes)
         {
            var inputID = "id_" + t.ticket_name;
             <div class="form-group">
                 <label for=@inputID class="col-md-2 control-label">@t.ticket_name</label>
                 <input type="hidden" name="@("ticketPurchase[" + count + "]").Key" value="@t.ticket_type_id"/>
                 <div class="col-md-10">
                     <input name="@("ticketPurchase[" + count + "]").Value" type="number" id=@inputID value="0" class="form-control" min="0"/>
                 </div>
             </div>
             count++;
         }

        <div class="form-group">
            <label class="col-md-2 control-label">Hotel</label>
            <div class="col-md-10">
                @Html.DropDownList("Hotels", null, htmlAttributes: new {@class = "form-control", @onChange = "updateRooms();", @id = "id_hotel"})
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-2 control-label">Room Type</label>
            <div class="col-md-10">
                @Html.DropDownList("RoomTypes", null, htmlAttributes: new {@class = "form-control", @onChange = "updateRooms();", @id = "id_room_type"})
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-2 control-label">Room</label>
            <div class="col-md-10">
                <select id="id_room_list_searched" disabled name="Room">
                    <option value="-1">Select a Room</option>
                </select>
                @Html.DropDownList("Rooms", null, htmlAttributes: new {@id = "id_room_list_full"})
            </div>
        </div>

        <input type="submit" value="Go" class="btn btn-success"/>
    </div>   
}

<script type="text/javascript">
    function updateRooms($, window) {
        var room = document.getElementById("id_room_list_searched");
        var roomList = document.getElementById("id_room_list_full").options;

        var hotel = document.getElementById("id_hotel");
        var roomType = document.getElementById("id_room_type");

        var selectedHotel = hotel.options[hotel.selectedIndex].value;
        var selectedRoomType = roomType.options[roomType.selectedIndex].value;

        room.options = room.options.empty;
        var defaultRoomOption = document.createElement("option");
        defaultRoomOption.text = "Select a room";
        defaultRoomOption.value = "-1";
        room = room.add(defaultRoomOption);

        for (var k = 0; k < roomList.length; k++) {
            var listVal = roomList[k].value.split(" ");
            var listHotel = listVal[0];
            var listRoomType = listVal[1];
            var listRoomNumber = roomList[k].Text;

            if (selectedHotel === listHotel && selectedRoomType === listRoomType) {
                var newOption = document.createElement("option");
                newOption.text = roomList[k].text;
                newOption.value = roomList[k].value;
            }
        }
        alert(selectedHotel + " = hotel, " + selectedRoomType + " = room type \n" + roomListString);
    }
</script>